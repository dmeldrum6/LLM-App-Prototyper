<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM App Prototyper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .chat-panel {
            width: 40%;
            display: flex;
            flex-direction: column;
            background: white;
            border-right: 1px solid #e0e0e0;
        }

        .preview-panel {
            width: 60%;
            display: flex;
            flex-direction: column;
            background: #fafafa;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .message {
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #555;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .message-content {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            line-height: 1.5;
        }

        .user-message .message-content {
            background: #667eea;
            color: white;
            margin-left: 2rem;
        }

        .assistant-message .message-content {
            background: #f0f0f0;
            color: #333;
            margin-right: 2rem;
        }

        .system-message .message-content {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            font-size: 0.9rem;
        }

        .input-area {
            padding: 1rem;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .input-group {
            display: flex;
            gap: 0.5rem;
        }

        textarea {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            resize: none;
            transition: border-color 0.2s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 0.75rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .preview-header {
            padding: 1rem;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-header h2 {
            font-size: 1.1rem;
            color: #333;
        }

        .preview-actions {
            display: flex;
            gap: 0.5rem;
        }

        .preview-actions button {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .download-btn {
            background: #10b981;
        }

        .download-btn:hover:not(:disabled) {
            background: #059669;
        }

        .clear-btn {
            background: #ef4444;
        }

        .clear-btn:hover:not(:disabled) {
            background: #dc2626;
        }

        .preview-content {
            flex: 1;
            padding: 1rem;
            overflow: hidden;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }

        .no-preview {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 1.1rem;
        }

        .api-key-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
        }

        .modal-content h2 {
            margin-bottom: 1rem;
            color: #333;
        }

        .modal-content p {
            margin-bottom: 1.5rem;
            color: #666;
            line-height: 1.6;
        }

        .modal-content input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            margin-bottom: 1rem;
        }

        .modal-content input:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .settings-btn {
            background: transparent;
            border: 2px solid white;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        body.dark-mode .header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
        }

        body.dark-mode .chat-panel {
            background: #2d2d2d;
            border-right: 1px solid #404040;
        }

        body.dark-mode .preview-panel {
            background: #1a1a1a;
        }

        body.dark-mode .preview-header {
            background: #2d2d2d;
            border-bottom: 1px solid #404040;
        }

        body.dark-mode .preview-header h2 {
            color: #e0e0e0;
        }

        body.dark-mode .message-label {
            color: #b0b0b0;
        }

        body.dark-mode .user-message .message-content {
            background: #4a5568;
        }

        body.dark-mode .assistant-message .message-content {
            background: #3a3a3a;
            color: #e0e0e0;
        }

        body.dark-mode .system-message .message-content {
            background: #3d3520;
            color: #ffd700;
            border: 1px solid #5d5020;
        }

        body.dark-mode .input-area {
            background: #2d2d2d;
            border-top: 1px solid #404040;
        }

        body.dark-mode textarea {
            background: #3a3a3a;
            color: #e0e0e0;
            border: 2px solid #505050;
        }

        body.dark-mode textarea:focus {
            border-color: #667eea;
        }

        body.dark-mode .no-preview {
            color: #666;
        }

        body.dark-mode .modal-content {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        body.dark-mode .modal-content h2 {
            color: #e0e0e0;
        }

        body.dark-mode .modal-content p {
            color: #b0b0b0;
        }

        body.dark-mode .modal-content input {
            background: #3a3a3a;
            color: #e0e0e0;
            border: 2px solid #505050;
        }

        body.dark-mode .modal-content input:focus {
            border-color: #667eea;
        }

        body.dark-mode .modal-content label {
            color: #b0b0b0 !important;
        }

        body.dark-mode iframe {
            border: 2px solid #404040;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ LLM App Prototyper</h1>
        <p>Generate self-contained web applications with AI</p>
        <div class="header-actions">
            <button class="settings-btn" onclick="newApp()">‚ú® New App</button>
            <button class="settings-btn" onclick="toggleDarkMode()">üåì Toggle Theme</button>
            <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è API Settings</button>
        </div>
    </div>

    <div class="container">
        <div class="chat-panel">
            <div class="chat-messages" id="chatMessages"></div>
            <div class="input-area">
                <div class="input-group">
                    <textarea
                        id="userInput"
                        placeholder="Describe the web app you want to create... (e.g., 'A weekly scheduling system for a label printing company with 7 pieces of equipment')"
                        rows="3"
                    ></textarea>
                    <button id="sendBtn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>

        <div class="preview-panel">
            <div class="preview-header">
                <h2>Preview</h2>
                <div class="preview-actions">
                    <button class="download-btn" id="downloadBtn" onclick="downloadApp()" disabled>Download HTML</button>
                    <button class="clear-btn" onclick="clearPreview()">Clear</button>
                </div>
            </div>
            <div class="preview-content" id="previewContent">
                <div class="no-preview">No app generated yet</div>
            </div>
        </div>
    </div>

    <div id="apiKeyModal" class="api-key-modal" style="display: none;">
        <div class="modal-content">
            <h2>LLM API Configuration</h2>
            <p>Configure your LLM API settings. All settings are stored locally in your browser.</p>

            <label for="apiUrlInput" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #555;">API URL</label>
            <input type="text" id="apiUrlInput" placeholder="https://api.openai.com/v1/chat/completions" style="margin-bottom: 1rem;">

            <label for="apiModelInput" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #555;">Model</label>
            <input type="text" id="apiModelInput" placeholder="gpt-4o" style="margin-bottom: 1rem;">

            <label for="apiKeyInput" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #555;">API Key</label>
            <input type="password" id="apiKeyInput" placeholder="sk-..." style="margin-bottom: 1rem;">

            <div class="modal-actions">
                <button onclick="saveApiKey()">Save</button>
            </div>
        </div>
    </div>

    <script>
        let currentGeneratedHTML = '';
        let conversationHistory = [];
        let apiKey = localStorage.getItem('openai_api_key') || '';
        let apiUrl = localStorage.getItem('api_url') || 'https://api.openai.com/v1/chat/completions';
        let apiModel = localStorage.getItem('api_model') || 'gpt-4o';
        let darkMode = localStorage.getItem('dark_mode') === 'true';

        // Check for API key on load
        if (!apiKey) {
            document.getElementById('apiKeyModal').style.display = 'flex';
        }

        // Apply dark mode on load
        if (darkMode) {
            document.body.classList.add('dark-mode');
        }

        function openSettings() {
            document.getElementById('apiKeyInput').value = apiKey;
            document.getElementById('apiUrlInput').value = apiUrl;
            document.getElementById('apiModelInput').value = apiModel;
            document.getElementById('apiKeyModal').style.display = 'flex';
        }

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            const url = document.getElementById('apiUrlInput').value.trim();
            const model = document.getElementById('apiModelInput').value.trim();

            if (key && url && model) {
                apiKey = key;
                apiUrl = url;
                apiModel = model;
                localStorage.setItem('openai_api_key', key);
                localStorage.setItem('api_url', url);
                localStorage.setItem('api_model', model);
                document.getElementById('apiKeyModal').style.display = 'none';
                addMessage('system', 'API settings saved successfully!');
            } else {
                alert('Please fill in all fields');
            }
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('dark_mode', darkMode);
        }

        function newApp() {
            // Clear conversation history
            conversationHistory = [];
            // Clear chat messages
            document.getElementById('chatMessages').innerHTML = '';
            // Clear preview
            clearPreview();
            addMessage('system', 'Started new app. Context cleared.');
        }

        function addMessage(role, content) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message`;

            const label = role === 'user' ? 'You' : role === 'assistant' ? 'Assistant' : 'System';
            messageDiv.innerHTML = `
                <div class="message-label">${label}</div>
                <div class="message-content">${escapeHtml(content)}</div>
            `;

            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();

            if (!message) return;

            if (!apiKey) {
                alert('Please set your OpenAI API key first');
                openSettings();
                return;
            }

            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span class="loading"></span>Generating...';

            addMessage('user', message);
            input.value = '';

            try {
                // Build conversation history
                const messages = [
                    {
                        role: 'system',
                        content: `You are an expert web developer. Generate a complete, self-contained, single-file HTML application based on user requirements.

CRITICAL REQUIREMENTS:
1. Generate ONLY the HTML code - no explanations, no markdown, no code fences
2. The HTML must be complete and ready to use as-is
3. Include all CSS in a <style> tag in the <head>
4. Include all JavaScript in a <script> tag before </body>
5. Make it fully functional with all requested features
6. Use modern, clean design with good UX
7. Include responsive design
8. Add appropriate colors, spacing, and visual polish
9. Make it production-ready and professional looking

The output should start with <!DOCTYPE html> and nothing else. Do not wrap it in markdown code blocks or add any explanatory text.`
                    },
                    ...conversationHistory,
                    {
                        role: 'user',
                        content: message
                    }
                ];

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: apiModel,
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: 4000
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API request failed');
                }

                const data = await response.json();
                let generatedHTML = data.choices[0].message.content.trim();

                // Remove markdown code blocks if present
                generatedHTML = generatedHTML.replace(/```html\n?/g, '').replace(/```\n?/g, '');

                currentGeneratedHTML = generatedHTML;

                // Store conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });
                conversationHistory.push({
                    role: 'assistant',
                    content: generatedHTML
                });

                addMessage('assistant', 'App generated successfully! Preview it on the right and download when ready.');

                // Show preview
                const previewContent = document.getElementById('previewContent');
                previewContent.innerHTML = '<iframe id="previewFrame"></iframe>';

                const iframe = document.getElementById('previewFrame');
                iframe.srcdoc = generatedHTML;

                document.getElementById('downloadBtn').disabled = false;

            } catch (error) {
                addMessage('system', `Error: ${error.message}`);
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send';
            }
        }

        function downloadApp() {
            if (!currentGeneratedHTML) return;

            const blob = new Blob([currentGeneratedHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `app-${Date.now()}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            addMessage('system', 'App downloaded successfully!');
        }

        function clearPreview() {
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = '<div class="no-preview">No app generated yet</div>';
            currentGeneratedHTML = '';
            document.getElementById('downloadBtn').disabled = true;
        }

        // Allow Enter to send (Shift+Enter for new line)
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>
